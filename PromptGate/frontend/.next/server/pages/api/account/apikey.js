"use strict";(()=>{var e={};e.id=466,e.ids=[466],e.modules={4001:e=>{e.exports=require("@supabase/auth-helpers-nextjs")},2885:e=>{e.exports=require("@supabase/supabase-js")},3582:e=>{e.exports=require("cors")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},6563:(e,r,t)=>{t.r(r),t.d(r,{config:()=>g,default:()=>h,routeModule:()=>f});var a={};t.r(a),t.d(a,{default:()=>handler});var s=t(1802),o=t(7153),n=t(6249),i=t(3582),u=t.n(i),d=t(4001),p=t(2201),c=t(9492);let l=u()({methods:["POST","GET","HEAD"]}),refreshUserApikeyInDb=async(e,r)=>{let{error:t}=await c.oY.from("accounts").update({user_apikey:r}).eq("id",e.id);if(t)throw console.error(`Error updating apikey for user ${e.id}`),console.error(t),Error("Error updating apikey")};async function handler(e,r){if(await new Promise((t,a)=>{l(e,r,e=>e instanceof Error?a(e):t(e))}),"POST"!==e.method)return r.status(405).json({error:"not_allowed",message:"Method not allowed"});let t=(0,d.createServerSupabaseClient)({req:e,res:r}),{data:{session:a}}=await t.auth.getSession();if(!a)return r.status(401).json({error:"not_authenticated",message:"not authenticated"});let{data:{user:s}}=await t.auth.getUser();if(!s)return r.status(401).json({error:"not_authenticated",message:"not authenticated"});try{let e=(0,p.Z)();return await refreshUserApikeyInDb(s,e),r.status(200).json({apikey:e})}catch(e){return console.error(e),r.status(500).json({error:"server_error",message:"something went wrong"})}}let h=(0,n.l)(a,"default"),g=(0,n.l)(a,"config"),f=new s.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/account/apikey",pathname:"/api/account/apikey",bundlePath:"",filename:""},userland:a})},2201:(e,r,t)=>{t.d(r,{Z:()=>generateApiKey});var a=t(6113);function generateApiKey(e=64){let r=Math.ceil(e/2),t=(0,a.randomBytes)(r).toString("hex");return t.substring(0,e)}}};var r=require("../../../webpack-api-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),t=r.X(0,[222,492],()=>__webpack_exec__(6563));module.exports=t})();